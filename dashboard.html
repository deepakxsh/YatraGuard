<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>YatraGuard Dashboard</title>
  <link rel="stylesheet" href="dashboard.css">
  <script src="dashboard.js" defer></script>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css"/>
  <style>
    nav {
      width: 100%;
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px 15px;
      background: rgba(0,0,0,0.65);
      position: fixed;
      top: 0;
      left: 0;
      z-index: 20;
      backdrop-filter: blur(8px);
      box-shadow: 0 8px 32px rgba(0,0,0,0.25);
    }
    nav .logo {
      color: #fff;
      font-weight: 700;
      font-size: 1.3rem;
      letter-spacing: 1px;
    }
    nav ul {
      list-style: none;
      padding: 0;
      margin: 0;
      display: flex;
      align-items: center;
    }
    nav ul li {
      position: relative;
      margin-left: 30px;
    }
    nav ul li a, nav ul li button {
      padding: 10px 22px;
      text-decoration: none;
      color: #fff;
      font-size: 16px;
      border-radius: 12px;
      background: none;
      border: none;
      cursor: pointer;
      font-weight: 500;
      transition: color 0.3s;
    }
    nav ul li a:hover, nav ul li button:hover {
      color: orange;
      background: none;
    }
    .arrow {
      margin-left: 8px;
      font-size: 14px;
      transition: transform 0.3s cubic-bezier(.25,.8,.25,1);
      color: #ffb74d;
      font-weight: bold;
    }
    .arrow.open {
      transform: rotate(90deg);
      color: #fff;
    }
    .submenu {
      position: absolute;
      left: 0;
      top: 110%;
      background: rgba(30,30,40,0.92);
      border-radius: 18px;
      min-width: 210px;
      box-shadow: 0 12px 32px rgba(0,0,0,0.25), 0 1.5px 8px #ff9800;
      max-height: 0;
      overflow: hidden;
      opacity: 0;
      transition: max-height 0.5s cubic-bezier(.25,.8,.25,1), opacity 0.3s;
      z-index: 100;
      border: 1.5px solid rgba(255,152,0,0.18);
      backdrop-filter: blur(12px);
      padding: 0;
    }
    .submenu.open {
      max-height: 600px;
      opacity: 1;
      padding: 12px 0;
      animation: fadeInSubmenu 0.5s;
    }
    @keyframes fadeInSubmenu {
      from { opacity: 0; transform: translateY(-10px);}
      to { opacity: 1; transform: translateY(0);}
    }
    .submenu li {
      margin: 0;
      width: 100%;
    }
    .submenu a {
      font-size: 15px;
      padding: 12px 24px;
      background: linear-gradient(90deg, rgba(255,255,255,0.04) 0%, rgba(255,152,0,0.08) 100%);
      color: #fff;
      border-radius: 10px;
      transition: background 0.2s, color 0.2s, transform 0.2s;
      margin: 2px 0;
      display: block;
      box-shadow: 0 1px 4px rgba(255,152,0,0.08);
    }
    .submenu a:hover {
      background: linear-gradient(90deg, #ff9800 0%, #ffb74d 100%);
      color: #fff;
      transform: scale(1.04) translateX(6px);
      box-shadow: 0 4px 16px rgba(255,152,0,0.18);
    }
    .sos {
      background: linear-gradient(90deg, #ff1744 0%, #ff8a65 100%);
      border: none;
      color: white;
      padding: 10px 22px;
      border-radius: 12px;
      cursor: pointer;
      font-weight: bold;
      box-shadow: 0 4px 16px rgba(255,23,68,0.18);
      transition: background 0.3s, transform 0.2s;
    }
    .sos:hover {
      background: linear-gradient(90deg, #d50000 0%, #ff8a65 100%);
      transform: scale(1.08);
    }
    #map-modal-overlay {
      display: none;
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.7);
      z-index: 9999;
      justify-content: center;
      align-items: center;
    }
    #map-modal {
      background: rgba(30,30,40,0.98);
      border-radius: 20px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.45);
      padding: 30px;
      max-width: 900px;
      width: 80vw;
      max-height: 80vh;
      position: relative;
      display: flex;
      flex-direction: column;
      align-items: center;
    }
    #map-modal-close {
      position: absolute;
      top: 18px;
      right: 24px;
      background: #ff4b5c;
      color: #fff;
      border: none;
      border-radius: 8px;
      padding: 8px 16px;
      font-weight: bold;
      cursor: pointer;
      z-index: 2;
      box-shadow: 0 2px 8px rgba(255,75,92,0.18);
    }
    #map-modal-title {
      color: #fff;
      margin-bottom: 18px;
      font-size: 1.4rem;
      font-weight: 600;
      letter-spacing: 1px;
    }
    #map-modal-map {
      width: 100%;
      height: 400px;
      border-radius: 15px;
      box-shadow: 0 4px 30px rgba(0,0,0,0.4);
      margin-bottom: 10px;
    }
    #ai-chatbot-bubble {
      position:fixed; bottom:20px; right:20px; width:60px; height:60px;
      background:#00c6ff; border-radius:50%; cursor:pointer;
      display:flex; align-items:center; justify-content:center; z-index:9999;
      box-shadow:0 4px 15px rgba(0,0,0,0.3);
      font-size:2rem;
    }
    #ai-chatbot-panel {
      position:fixed; top:0; right:-35%; width:35%; height:100%;
      background:rgba(20,20,20,0.95); backdrop-filter:blur(15px);
      box-shadow:-4px 0 25px rgba(0,0,0,0.5); border-left:1px solid rgba(255,255,255,0.2);
      display:flex; flex-direction:column; transition:0.5s ease; z-index:9998;
    }
  </style>
</head>
<body>

  <!-- Background Video -->
  <video autoplay muted loop id="bgVideo">
    <source src="bg-video.mp4" type="video/mp4">
    Your browser does not support HTML5 video.
  </video>

  <!-- Overlay -->
  <div class="overlay">

    <!-- Navbar (Accordion) -->
    <nav>
      <div class="logo">HI DEEPAKASH</div>
      <ul>
        <li>
          <a href="#">Check-In <span class="arrow"></span></a>
          <ul class="submenu">
            <li><a href="scan_qr.html">Scan QR</a></li>
            <li><a href="show_qr.html">Show QR</a></li>
          </ul>
        </li>
        
        <li>
          <a href="#">Trip History <span class="arrow"></span></a>
          <ul class="submenu">
            <li><a href="#" id="map-history-link">Map History</a></li>
            <li><a href="flight_history.html" id="flight-history-link">Flight History</a></li>
            <li><a href="taxi.html" id="taxi-history-link">Taxi History</a></li>
            <li><a href="hotel.html" id="hotel-history-link">Hotel History</a></li>
          </ul>
        </li>
        <li><a href="safety.html">Safety Tips</a></li>
        <li>
          <a href="#">Emergency Contacts <span class="arrow"></span></a>
          <ul class="submenu">
            <li><a href="#">Favorite Contacts</a></li>
            <li><a href="nearby_tourists.html">Nearby Tourists</a></li>
            <li><a href="local_emergency.html">Local Emergency Numbers</a></li>
          </ul>
        </li>
        <li><a href="settings.html">Settings</a></li>
        <li>
          <a href="#">Connect <span class="arrow"></span></a>
          <ul class="submenu">
            <li><a href="#">Let AI Connect</a></li>
            <li><a href="#">Connect Manually</a></li>
          </ul>
        </li>
        <li>
          <a href="#">Help <span class="arrow"></span></a>
          <ul class="submenu">
            <li><a href="#">AI Not Working</a></li>
            <li><a href="#">Location Not Working</a></li>
            <li><a href="#">Trouble Using App</a></li>
            <li><a href="#">AI Help</a></li>
          </ul>
        </li>
        <li><a href="#" onclick="loadTranslator()">Translator</a></li>
        <li>
          <a href="#">Offline Help <span class="arrow">‚ñ∂</span></a>
          <ul class="submenu">
            <li><a href="offline_map.html">Map</a></li>
            <li><a href="offline_translator.html">Translator</a></li>
          </ul>
        </li>
        <li><button class="sos" onclick="window.location.href='ar_landing.html'">GOT LOST?</button></li>
      <li><button class="sos" onclick="window.location.href='sos.html'">SOS</button></li>

      </ul>
    </nav>

    <!-- Main Layout -->
    <div class="main-content">
      <!-- Left Content -->
      <div class="left-content">
        <h1>TRAVEL SAFE, TRAVEL SMART.<br>EXPLORE NORTHEAST WITH YATRAGUARD?</h1>
        <p class="subtitle">
          Your trusted travel companion ‚Äì ensuring <b>safety</b>, <b>guidance</b>, and <b>real-time assistance</b> while you explore the Northeast.
        </p>
        <div class="buttons">
          <button class="orange-btn" onclick="location.href='trip-details.html'">
            TELL US WHERE YOU ARE HEADING
          </button>
          <button class="orange-btn" onclick="window.open('crowd-heatmap.html', '_blank')">
            EXPLORE CROWD HEATMAP
          </button>
        </div>
      </div>

      <!-- Right Panel (center right, vertical stack) -->
      <div class="right-panel">
        <div id="map"></div>
        <div class="info-boxes">
          <div class="info-card" onclick="window.location.href='taxi.html'">
            <h2>üöñ Last Taxi Trip</h2>
            <p>View your most recent taxi trip details ‚Äì pickup, drop, driver info & safety rating.</p>
          </div>
          <div class="info-card" onclick="window.location.href='hotel.html'">
            <h2>üè® Hotel Details</h2>
            <p>Check your hotel booking details, location and nearby emergency contacts.</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Map Modal Overlay -->
  <div id="map-modal-overlay">
    <div id="map-modal">
      <button id="map-modal-close">Close</button>
      <div id="map-modal-title">Trip Route Map</div>
      <div id="map-modal-map"></div>
      <ul style="margin-top:18px; color:#fff; font-size:1.08rem;">
        <li>Delhi ‚Äì 0 km</li>
        <li>Jaipur ‚Äì 280 km</li>
        <li>Mumbai ‚Äì 1200 km</li>
        <li>Goa ‚Äì 1600 km</li>
        <li>Bangalore ‚Äì 2100 km</li>
        <li>Chennai ‚Äì 2500 km</li>
      </ul>
    </div>
  </div>

  <!-- ===== AI Chatbot Bubble ===== -->
  <div id="ai-chatbot-bubble">
    ü§ñ
  </div>

  <!-- ===== AI Chatbot Panel ===== -->
  <div id="ai-chatbot-panel">
    <!-- Header -->
    <div style="padding:15px; font-weight:bold; font-size:18px; color:#fff; display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid rgba(255,255,255,0.1);">
      AI Chatbot
      <span id="close-chatbot" style="cursor:pointer; font-size:20px;">‚úñÔ∏è</span>
    </div>
    <!-- Chat Messages -->
    <div id="chat-messages" style="flex:1; overflow-y:auto; padding:15px; display:flex; flex-direction:column; gap:10px;">
      <!-- Messages will appear here dynamically -->
    </div>
    <!-- Input Area -->
    <div style="padding:10px; border-top:1px solid rgba(255,255,255,0.1); display:flex; gap:5px;">
      <input id="chat-input" type="text" placeholder="Ask me anything..."
             style="flex:1; padding:10px; border-radius:15px; border:none; outline:none;"/>
      <button id="chat-send"
              style="padding:10px 15px; border-radius:15px; border:none; background:#00c6ff; color:#000; font-weight:bold; cursor:pointer;">Send</button>
    </div>
  </div>

  <script src="meghalayaData.js"></script>
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    // Dropdown menu logic
    document.querySelectorAll('nav ul > li > a').forEach(item => {
      item.addEventListener('click', function(e) {
        const submenu = item.nextElementSibling;
        const arrow = item.querySelector('.arrow');
        // Only toggle if submenu exists
        if (submenu && submenu.classList.contains('submenu')) {
          e.preventDefault();
          submenu.classList.toggle('open');
          arrow.classList.toggle('open');
        }
      });
    });

    // Translator loader (inline in main content)
    function loadTranslator() {
      alert('Translator UI would appear here (prototype).');
    }

    // Map History Modal Logic
    let mapModalOverlay = document.getElementById('map-modal-overlay');
    let mapModalClose = document.getElementById('map-modal-close');
    let leafletMap = null;

    document.getElementById('map-history-link').addEventListener('click', function(e) {
      e.preventDefault();
      mapModalOverlay.style.display = 'flex';

      // Only initialize map once
      if (!leafletMap) {
        leafletMap = L.map('map-modal-map').setView([22.5, 78.9], 5);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
          attribution: '¬© OpenStreetMap contributors'
        }).addTo(leafletMap);

        var routeCoords = [
          [28.7041, 77.1025], // Delhi
          [26.9124, 75.7873], // Jaipur
          [19.0760, 72.8777], // Mumbai
          [15.2993, 74.1240], // Goa
          [12.9716, 77.5946], // Bangalore
          [13.0827, 80.2707]  // Chennai
        ];
        var routeLine = L.polyline(routeCoords, {color: 'cyan', weight: 5, opacity:0.7}).addTo(leafletMap);
        leafletMap.fitBounds(routeLine.getBounds());
        var cities = ["Delhi", "Jaipur", "Mumbai", "Goa", "Bangalore", "Chennai"];
        for (let i=0; i<routeCoords.length; i++) {
          L.circleMarker(routeCoords[i], {radius:8, color:'#ff4b5c', fillColor:'#ff4b5c', fillOpacity:0.9})
            .bindPopup(cities[i])
            .addTo(leafletMap);
        }
      } else {
        setTimeout(function() { leafletMap.invalidateSize(); }, 200);
      }
    });

    // Close modal on button click
    mapModalClose.addEventListener('click', function() {
      mapModalOverlay.style.display = 'none';
    });

    // Close modal when clicking outside the modal box
    mapModalOverlay.addEventListener('mousedown', function(e) {
      if (e.target === mapModalOverlay) {
        mapModalOverlay.style.display = 'none';
      }
    });

    // Also close map modal when clicking anywhere outside the modal
    document.addEventListener('mousedown', function(e) {
      if (mapModalOverlay.style.display === 'flex' && !mapModalOverlay.contains(e.target)) {
        mapModalOverlay.style.display = 'none';
      }
    });

    // Redirect for Flight/Taxi/Hotel History
    document.getElementById('flight-history-link').addEventListener('click', function(e) {
      window.location.href = 'flight_history.html';
    });
    document.getElementById('taxi-history-link').addEventListener('click', function(e) {
      window.location.href = 'taxi.html';
    });
    document.getElementById('hotel-history-link').addEventListener('click', function(e) {
      window.location.href = 'hotel.html';
    });

    // ===== AI Chatbot Bubble & Panel Logic =====
    const bubble = document.getElementById('ai-chatbot-bubble');
    const panel = document.getElementById('ai-chatbot-panel');
    const closeBtn = document.getElementById('close-chatbot');
    const messagesDiv = document.getElementById('chat-messages');
    const input = document.getElementById('chat-input');
    const sendBtn = document.getElementById('chat-send');

    // Toggle Panel
    bubble.onclick = () => {
      panel.style.right = '0';
      bubble.style.display = 'none';
    };
    closeBtn.onclick = () => {
      panel.style.right = '-35%';
      bubble.style.display = 'flex';
    };

    // Send Message
    sendBtn.onclick = sendMessage;
    input.addEventListener("keypress", function(e) { if(e.key==="Enter") sendMessage(); });

    function sendMessage() {
      let userText = input.value.trim();
      if(!userText) return;
      addMessage(userText, 'user');
      input.value = '';

      // If MEGHALAYA_QA is loaded, use it for answers
      if (window.MEGHALAYA_QA && Array.isArray(window.MEGHALAYA_QA)) {
        let reply = findAnswer(userText);
        addMessage(reply, 'ai');
        return;
      }

      // Simulate AI response with simple rules
      setTimeout(() => {
        let aiText = getAIResponse(userText);
        addMessage(aiText, 'ai');
      }, 800);
    }

    function addMessage(text, sender) {
      const msg = document.createElement('div');
      msg.innerHTML = text;
      msg.style.padding = '10px 15px';
      msg.style.borderRadius = '15px';
      msg.style.maxWidth = '80%';
      msg.style.wordWrap = 'break-word';
      msg.style.boxShadow = '0 2px 8px rgba(0,0,0,0.3)';
      msg.style.backdropFilter = 'blur(5px)';
      msg.style.background = sender==='ai' ? 'rgba(0,198,255,0.15)' : 'rgba(255,255,255,0.15)';
      msg.style.alignSelf = sender==='ai' ? 'flex-start' : 'flex-end';
      messagesDiv.appendChild(msg);
      messagesDiv.scrollTop = messagesDiv.scrollHeight;
    }

    function getAIResponse(text) {
      text = text.toLowerCase();
      // Simple rules-based prototype
      if(text.includes('taxi')) return 'Redirecting to your Taxi History page... <a href="taxi.html" style="color:#0ff;">Click here</a>';
      if(text.includes('hotel')) return 'You can check your Hotel History here: <a href="hotel.html" style="color:#0ff;">View Hotels</a>';
      if(text.includes('flight')) return 'You have a flight from Delhi to Mumbai on 12 Aug, seat 14A.';
      if(text.includes('emergency')) return 'You can see nearby tourists or local emergency numbers in the Emergency Contacts section.';
      if(text.includes('hi') || text.includes('hello')) return 'Hello! How can I assist you with your travel today?';
      if(text.includes('recommend')) return 'Based on your past trips, I suggest Hotel Luxe in Mumbai or Hotel Royale in Bangalore.';
      return 'Sorry, I am still learning. Please ask about trips, hotels, taxis, or safety info.';
    }

    // ===== Meghalaya Q&A logic =====
    function findAnswer(userInput) {
      userInput = userInput.toLowerCase();
      let bestMatch = null;
      let bestScore = 0;

      window.MEGHALAYA_QA.forEach(qa => {
        let score = 0;
        let q = qa.question.toLowerCase();

        // Simple keyword match
        userInput.split(" ").forEach(word => {
          if (q.includes(word)) {
            score++;
          }
        });

        if (score > bestScore) {
          bestScore = score;
          bestMatch = qa;
        }
      });

      if (bestMatch && bestScore > 0) {
        return bestMatch.answer;
      } else {
        return "ü§ñ Sorry, I don‚Äôt have info on that yet. Try asking about places, food, travel, or culture in Meghalaya.";
      }
    }
  </script>
</body>
</html>