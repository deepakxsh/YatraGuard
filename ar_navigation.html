<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AR Navigation</title>
  <style>
    body {
      margin: 0;
      overflow: hidden;
      background: black;
      font-family: Arial, sans-serif;
      color: white;
      text-align: center;
    }
    video {
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 100vh;
      object-fit: cover;
      z-index: -1;
    }
    #arrow {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      font-size: 100px;
      color: red;
      text-shadow: 2px 2px 10px black;
    }
    #info {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0,0,0,0.5);
      padding: 10px 20px;
      border-radius: 10px;
    }
  </style>
</head>
<body>
  <video id="camera" autoplay playsinline></video>
  <div id="arrow">‚¨ÜÔ∏è</div>
  <div id="info">Fetching location...</div>

  <script>
    const arrow = document.getElementById("arrow");
    const info = document.getElementById("info");

    // üéØ Destination
    const destLat = 26.1085815;  
    const destLon = 91.8073465;  

    let currentLat, currentLon, currentHeading;

    // Open Camera
    navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } })
      .then(stream => {
        document.getElementById("camera").srcObject = stream;
      })
      .catch(err => {
        alert("Camera access denied: " + err);
      });

    // Get GPS Position
    navigator.geolocation.watchPosition(pos => {
      currentLat = pos.coords.latitude;
      currentLon = pos.coords.longitude;
      updateArrow();
    }, err => {
      info.innerText = "GPS Error: " + err.message;
    }, { enableHighAccuracy: true });

    // Handle Compass for Android + iOS
    function setupCompass() {
      if (typeof DeviceOrientationEvent.requestPermission === 'function') {
        // iOS requires permission
        DeviceOrientationEvent.requestPermission()
          .then(response => {
            if (response === 'granted') {
              window.addEventListener("deviceorientation", e => {
                currentHeading = e.alpha;
                updateArrow();
              });
            }
          })
          .catch(console.error);
      } else {
        // Android
        window.addEventListener("deviceorientationabsolute", e => {
          currentHeading = e.alpha;
          updateArrow();
        });
      }
    }
    setupCompass();

    function updateArrow() {
      if (currentLat == null || currentLon == null || currentHeading == null) return;

      const angleToDest = bearing(currentLat, currentLon, destLat, destLon);
      const diff = angleToDest - currentHeading;

      arrow.style.transform = `translate(-50%, -50%) rotate(${diff}deg)`;
      info.innerText = `Heading to (${destLat.toFixed(6)}, ${destLon.toFixed(6)})`;
    }

    function bearing(lat1, lon1, lat2, lon2) {
      const toRad = x => x * Math.PI / 180;
      const toDeg = x => x * 180 / Math.PI;
      const dLon = toRad(lon2 - lon1);
      const y = Math.sin(dLon) * Math.cos(toRad(lat2));
      const x = Math.cos(toRad(lat1)) * Math.sin(toRad(lat2)) -
                Math.sin(toRad(lat1)) * Math.cos(toRad(lat2)) * Math.cos(dLon);
      return (toDeg(Math.atan2(y, x)) + 360) % 360;
    }
  </script>
</body>
</html>
